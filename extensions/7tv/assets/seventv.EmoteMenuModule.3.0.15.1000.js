import{u as A,d as U}from"./seventv.ReactHooks.3.0.15.1000.js";import{a as O,d as G}from"./seventv.useModule.3.0.15.1000.js";import{d as V,G as h,a as B,l as p,f as E,j as k,k as I,u as g,y as z,z as H,_ as x,W,am as q,as as Z,w as J,a4 as K,al as P,s as w,aG as Q,Z as X,F as T,n as Y,m as ee,ak as _}from"./seventv.index.3.0.15.1000.js";import{r as b,u as C,n as te,l as ne,b as oe}from"./seventv.preload-helper.3.0.15.1000.js";import{u as ae}from"./seventv.useChannelContext.3.0.15.1000.js";import{u as se}from"./seventv.useChatEmotes.3.0.15.1000.js";import{_ as F}from"./seventv.StoreSubscribeButton.3.0.15.1000.js";import{u as ue}from"./seventv.useUpdater.3.0.15.1000.js";import{u as R,E as re}from"./seventv.EmoteMenu.3.0.15.1000.js";import{a as ce}from"./seventv.Settings.3.0.15.1000.js";const ie=d=>(z("data-v-7189c19d"),d=d(),H(),d),le=ie(()=>k("span",{class:"tooltip-over"},"Emote Menu",-1)),me={key:0,class:"seventv-emote-menu-update-flair"},pe=V({__name:"EmoteMenuButton",props:{onClick:{type:Function}},setup(d){const o=R(),r=ue(),c=b(!1),n=h("ui.emote_menu.button_placement");return B(n,i=>{c.value=i==="below"},{immediate:!0}),(i,f)=>c.value?(p(),E("div",{key:0,class:"seventv-tw-button seventv-emote-menu-button",onClick:f[0]||(f[0]=(...s)=>i.onClick&&i.onClick(...s))},[k("button",null,[I(F,{provider:"7TV",class:"icon"})]),le,!C(r).isUpToDate&&!C(o).open?(p(),E("div",me)):g("",!0)])):g("",!0)}});const S=x(pe,[["__scopeId","data-v-7189c19d"]]),de={class:"seventv-emote-menu-wrap"},fe=V({__name:"EmoteMenu",props:{instance:{},buttonEl:{}},setup(d){const o=d,r=b(),c=b(),n=R();n.channelID=o.instance.component.props.channelID??"";const i=ae(n.channelID,!0),f=ce(),s=se(i),l=b(),u=h("ui.emote_menu_search"),m=h("ui.emote_menu.usage"),v=O("chat"),D=h("ui.emote_menu.button_placement"),N=O("chat-input-controller");W(()=>{var e;(e=N.value)!=null&&e.instance&&N.value.instance.addButton("emote-menu",S,{onClick:()=>n.open=!n.open},1)});function M(e){const t=o.instance.component;if(e){t.onEmotePickerButtonClick();return}n.open?t.props.closeEmotePicker():(t.props.clearMenus(),typeof t.closeBitsCard=="function"&&t.closeBitsCard(),typeof t.closePaidPinnedChatCardForEmotePicker=="function"&&t.closePaidPinnedChatCardForEmotePicker(),typeof t.closeCheerCard=="function"&&t.closeCheerCard()),n.open=!n.open,Y(()=>{l.value&&l.value.focus()})}function L(e){const t=e.split(" ");for(const a of t){const y=s.active[a];y&&m.value.set(y.id,(m.value.get(y.id)??0)+1)}return m.value=new Map(m.value),e}B(v,e=>{!e||!e.instance||e.instance.messageSendMiddleware.set("emote-menu-usage",L)},{immediate:!0});function $(e){const t=o.instance.component.autocompleteInputRef;if(!t)return ne.warn("ref to input not found, cannot insert emote");let a=t.getValue();u.value?a=a.slice(0,n.filter.length?n.filter.length*-1:1/0):a=a.at(-1)===" "?a:a+" ",t.setValue(a+(e.unicode??e.name)+" "),o.instance.component.chatInputRef.focus()}q(o.instance.component,"onBitsIconClick",function(e){e==null||e(),n.open=!1}),Z(o.instance.component.autocompleteInputRef,"state",{value(e){if(!n.open){n.filter="";return}u.value&&(n.filter=e.value.split(" ").at(-1)??"")}});function j(e){f.open||!(e.target instanceof Node)||c.value&&c.value.contains(e.target)||o.buttonEl&&o.buttonEl.contains(e.target)||(n.open=!1)}return J(()=>{if(!r.value&&o.instance.domNodes.root){const e=o.instance.domNodes.root.querySelector(".chat-input");if(!e)return;const t=e.querySelector("[data-test-selector='chat-input']")??e;r.value=e,c.value=t}}),K(()=>{P(o.instance.component.autocompleteInputRef,"state"),P(o.instance.component,"onBitsIconClick")}),(e,t)=>(p(),E(T,null,[k("div",de,[r.value?(p(),w(re,{key:0,"anchor-el":r.value,width:"32.5rem",scale:"1rem",instance:o.instance,onEmoteClick:t[0]||(t[0]=a=>$(a)),onToggleNativeMenu:t[1]||(t[1]=a=>M(!0)),onClose:j},null,8,["anchor-el","instance"])):g("",!0)]),e.buttonEl&&C(D)==="regular"?(p(),w(X,{key:0,to:e.buttonEl},[I(S,{onClick:t[2]||(t[2]=a=>M())}),k("div",{class:te(["seventv-emote-menu-button",{"menu-open":C(n).open}]),onClick:t[3]||(t[3]=Q(a=>M(),["stop"]))},[I(F,{provider:"7TV"})],2)],8,["to"])):g("",!0)],64))}});const _e=x(fe,[["__scopeId","data-v-e397bcdb"]]),ve=[_("ui.emote_menu.default_tab","DROPDOWN",{path:["Appearance","Interface"],label:"Emote Menu: Default Emote Tab",hint:"Select default tab when opening emote menu",options:[["Favorite","FAVORITE"],["7TV","7TV"],["FFZ","FFZ"],["BTTV","BTTV"],["Platform","PLATFORM"],["Emoji","EMOJI"]],defaultValue:"7TV"}),_("ui.emote_menu_search","TOGGLE",{path:["Appearance","Interface"],label:"Emote Menu: Live Input Search",hint:"Use the chat's regular input box to search in the emote menu instead of the integrated search box",defaultValue:!1}),_("ui.emote_menu.button_placement","DROPDOWN",{path:["Appearance","Interface"],label:"Emote Menu Button Placement",hint:"Control where the 7TV emote menu button is placed. Setting to 'Below Input' will return the native emote menu to its original position.",options:[["Regular","regular"],["Below Input","below"],["Hidden","hidden"]],defaultValue:"regular"}),_("ui.emote_menu.most_used","TOGGLE",{path:["Appearance","Interface"],label:"Emote Menu: Most Used Emotes",hint:"Whether or not to display the emotes you type the most in the emote menu (Temporarily disabled due to performance issues)",disabledIf:()=>!0,defaultValue:!0}),_("ui.emote_menu.favorites","NONE",{path:["",""],label:"",defaultValue:new Set}),_("ui.emote_menu.usage","NONE",{path:["",""],label:"",defaultValue:new Map,serialize:!1}),_("ui.emote_menu.collapsed_sets","NONE",{path:["",""],label:"",defaultValue:new Set,serialize:!1})],he=V({__name:"EmoteMenuModule",setup(d){const{markAsReady:o}=G("emote-menu",{name:"Emote Menu",depends_on:["settings"]}),r=b(),c=oe(new WeakMap),n=h("ui.emote_menu.button_placement"),i=A({parentSelector:".chat-room__content",maxDepth:150,predicate:s=>s.onEmotePickerButtonClick},{trackRoot:!0,containerClass:"seventv-chat-input-container",hooks:{render(s,l){return c.set(s,!!s.component.props.channelID),f(Object.values(s.domNodes)),l}}}),f=U(s=>{for(const l of s){const u=l.querySelector("button[data-a-target='emote-picker-button']");if(u){r.value=u;for(let m=0;m<u.childElementCount;m++){const v=u.children[m];v.classList.contains("seventv-emote-menu-button")||(n.value==="regular"?v.classList.add("seventv-emote-menu-overriden"):v.classList.remove("seventv-emote-menu-overriden"))}}}},50);return B(n,s=>{for(const l of Object.values(i.instances).map(u=>u.domNodes))f(Object.values(l))},{immediate:!0}),o(),(s,l)=>(p(!0),E(T,null,ee(C(i).instances,u=>(p(),E(T,{key:u.identifier},[c.get(u)?(p(),w(_e,{key:0,instance:u,"button-el":r.value},null,8,["instance","button-el"])):g("",!0)],64))),128))}});const Ve=Object.freeze(Object.defineProperty({__proto__:null,config:ve,default:he},Symbol.toStringTag,{value:"Module"}));export{Ve as _};
