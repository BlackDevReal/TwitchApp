var l=Object.defineProperty;var m=(s,t,e)=>t in s?l(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var i=(s,t,e)=>(m(s,typeof t!="symbol"?t+"":t,e),e);import{u as f}from"./seventv.main.3.0.15.1000.js";import{b as c,M as r,l as h}from"./seventv.preload-helper.3.0.15.1000.js";import{Q as p,i as v,p as N,W as C,a4 as y}from"./seventv.index.3.0.15.1000.js";const n=Symbol("seventv-channel-context"),{sendMessage:o,target:d}=p();class b{constructor(){i(this,"platform","UNKNOWN");i(this,"id","");i(this,"username","");i(this,"displayName","");i(this,"user");i(this,"loaded",!1);i(this,"active",!1);i(this,"count",0);i(this,"actor",{roles:new Set})}get base(){return{id:this.id,username:this.username,displayName:this.displayName,active:this.active}}setCurrentChannel(t){if(o("STATE",{channel:r(this.base)}),this.id===t.id)return this.username=t.username,this.displayName=t.displayName,this.active=t.active,!1;const e=this.id;return this.id=t.id,this.username=t.username,this.displayName=t.displayName,this.active=t.active,a.set(t.id,this),a.delete(e),this.fetch(),!0}leave(){this.active=!1,o("STATE",{channel:r(this.base)})}fetch(){const t=e=>{this.id===e.detail.id&&(this.loaded=!0,this.user=e.detail.user,h.info("Channel loaded:",this.id),d.removeEventListener("channel_fetched",t))};d.addEventListener("channel_fetched",t)}}const a=new Map;function T(s,t=!1){let e=v(n,null);if(!e){e=(s?a.get(s):null)??c(new b),s&&e.setCurrentChannel({id:s??"",username:"",displayName:"",active:!0});const u=f();e.platform=u.platform,N(n,e),s&&a.set(s,e)}return t&&(C(()=>{e&&e.count++}),y(()=>{!e||!e.count||(e.count--,!(e.count>0)&&e.leave())})),e}export{T as u};
